#!/bin/bash

# Description:
#   This script aims at automating the creation process of a project workspace. It creates a
#   a folder for the workspace itself along with a few default subdirectories and note files.
#
# Usage:
#   ./archive-projects.sh
#   ./create-project.sh <CLIENT_NAME> <PROJECT_NAME>
# e.g.:
#   $ ./archive-projects.sh Acme Internal
#   [+] Successfully created project directory '/home/itm4n/Audit/2020-10-10_ACME_INTERNAL'.
#   [+] Created subdirectories.
#   [+] Created note files.

COLOR_RST="\e[0m"
COLOR_RED_BOLD="\e[1;31m"
COLOR_GREEN_BOLD="\e[1;32m"
COLOR_YELLOW_BOLD="\e[1;33m"
COLOR_BLUE_BOLD="\e[1;34m"

PROJECT_FOLDER="${HOME}/Audit"

function print_usage () {
    echo -e "${COLOR_BLUE_BOLD}[*]${COLOR_RST} Usage:   $0 <CLIENT_NAME> <PROJECT_NAME>"
    echo -e "${COLOR_BLUE_BOLD}[*]${COLOR_RST} E.g.:    $0 ACME INTERNAL"
}

if [ $# -lt 2 ]
then
    echo -e "${COLOR_RED_BOLD}[-]${COLOR_RST} Mising argument(s)!"
    print_usage
    exit
fi

# Create project folder if it does not already exist
if [ ! -d $PROJECT_FOLDER ];
then
    mkdir $PROJECT_FOLDER
fi

date=$(date +%F)
folder_name="${date}_${1^^}_${2^^}"
folder_path="${PROJECT_FOLDER}/${folder_name}"

mkdir "${folder_path}"
if [ $? != 0 ]
then
    echo -e "${COLOR_RED_BOLD}[-]${COLOR_RST} Failed to create project directory '${folder_path}'!"
    exit
fi

echo -e "${COLOR_GREEN_BOLD}[+]${COLOR_RST} Successfully created project directory '${folder_path}'."

folder_nmap="${folder_path}/recon"
folder_recon="${folder_path}/recon"

for d in "hosts" "loot" "nmap" "recon" "wordlists"
do
    mkdir "${folder_path}/${d}"
    if [ $? != 0 ]
    then
        echo -e "${COLOR_RED_BOLD}[-]${COLOR_RST} Failed to create subdirectories!"
        exit
    fi
done

echo -e "${COLOR_GREEN_BOLD}[+]${COLOR_RST} Created subdirectories."

ni=1
for n in "scope" "recon" "vulns" "misc" "summaries"
do
    note_path="${folder_path}/notes_${ni}_${n}.md"
    touch "${note_path}"
    if [ $? != 0 ]
    then
        echo -e "${COLOR_RED_BOLD}[-]${COLOR_RST} Failed to create note files!"
        exit
    fi
    echo -e "# ${n^}\n\n" > ${note_path}
    ni=$((ni+1))
done

echo -e "${COLOR_GREEN_BOLD}[+]${COLOR_RST} Created note files."